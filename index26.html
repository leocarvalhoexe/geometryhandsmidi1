<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MIDI Shape Manipulator v26</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; font-family: sans-serif; }
    canvas { display: block; }
    #info, #settingsButton, #openOutputPopupButton, #midiToggleButton, #operationModeButton { position: absolute; top: 10px; z-index: 100; padding: 10px; background-color: #444; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
    #info { left: 10px; }
    #settingsButton { left: 150px; }
    #openOutputPopupButton { left: 320px; }
    #midiToggleButton { left: 510px; }
    #operationModeButton { left: 670px; } /* Positioned after MIDI Toggle button */
    #infoModal, #settingsModal { display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
    .modal-content { background-color: #333; color: #fff; padding: 30px; border-radius: 10px; width: 80%; max-width: 600px; position: relative; max-height: 80vh; overflow-y: auto; }
    .modal-content h3 { margin-top: 0; border-bottom: 1px solid #555; padding-bottom: 10px; }
    .modal-content p, .modal-content ul { line-height: 1.6; }
    .modal-content ul { padding-left: 20px; }
    .modal-content a { color: #00bcd4; text-decoration: none; }
    .modal-content a:hover { text-decoration: underline; }
    #closeModal, #closeSettingsModal { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
    #closeModal:hover, #closeSettingsModal:hover { color: #fff; }
    .modal-footer { margin-top: 20px; padding-top: 15px; border-top: 1px solid #555; text-align: center; font-size: 0.9em; }
    /* Styles for the MIDI output select and its label */
    .modal-content label[for="midiOutputSelect"] { display: block; margin-bottom: 5px; color: #ccc; /* Lighter color for label text */ }
    #midiOutputSelect { width: 100%; padding: 8px; margin-top: 10px; border-radius: 4px; border: 1px solid #555; background-color: #222; color: white; font-size: 1em; }

    #hud {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <button id="info">‚ÑπÔ∏è Manual</button>
  <button id="settingsButton">‚öôÔ∏è Configura√ß√µes</button>
  <button id="openOutputPopupButton">‚ÜóÔ∏è Abrir Janela de Sa√≠da</button>
  <button id="midiToggleButton">üéπ MIDI ON</button>
  <button id="operationModeButton">üë§ Modo: 2 Pessoas</button>

  <div id="infoModal">
    <div class="modal-content">
      <span id="closeModal">&times;</span>
      <h3>Manual do Usu√°rio - v26</h3>

      <h4>Explica√ß√£o Geral do Projeto</h4>
      <p>Este projeto (v26) permite a manipula√ß√£o de <strong>duas formas geom√©tricas independentes</strong> e interativas atrav√©s dos movimentos das m√£os (capturados pela webcam, suportando uma ou duas pessoas) e integra essas intera√ß√µes com a gera√ß√£o de m√∫sica em tempo real via MIDI.</p>
      <p><strong>Novidades v26:</strong> Acordes ao redimensionar e sele√ß√£o de modo de opera√ß√£o (1 ou 2 pessoas).</p>

      <h4>Integra√ß√£o MIDI</h4>
      <p>O sistema utiliza a API Web MIDI do navegador para enviar mensagens MIDI. Cada forma possui seu pr√≥prio canal MIDI.</p>
      <ul>
        <li>As notas s√£o geradas sequencialmente para cada forma, com dire√ß√£o de rota√ß√£o revers√≠vel.</li>
        <li>O n√∫mero de lados da forma determina a quantidade de notas na sequ√™ncia.</li>
        <li>As notas s√£o mapeadas para uma escala harm√¥nica.</li>
        <li>O tamanho da forma (raio) controla a intensidade (velocity) das notas: formas maiores produzem notas mais fortes.</li>
        <li><strong>Novo:</strong> Ao redimensionar uma forma significativamente, um acorde de tr√™s notas (fundamental, ter√ßa, quinta da escala atual) √© tocado.</li>
        <li>A distor√ß√£o global da forma (calculada a partir das intera√ß√µes) afeta o pitch bend da nota atualmente tocada por aquela forma.</li>
        <li>As notas s√£o geradas em loop enquanto a forma estiver vis√≠vel (modo Legato) ou com curta dura√ß√£o (modo Staccato).</li>
        <li>O modo Pulso modula ritmicamente a velocidade das notas e o tamanho visual das formas.</li>
      </ul>

      <h4>Manipula√ß√£o das Formas com as M√£os</h4>
      <p>O sistema pode operar em modo de <strong>1 Pessoa</strong> ou <strong>2 Pessoas</strong> (selecion√°vel via bot√£o "Modo").</p>
      <ul>
        <li><strong>Modo 1 Pessoa:</strong> Ambas as formas respondem √†s m√£os da mesma pessoa.</li>
        <li><strong>Modo 2 Pessoas:</strong> Cada pessoa controla uma forma (Forma 1 pela primeira pessoa detectada, Forma 2 pela segunda).</li>
      </ul>
      <p>Gestos de controle:</p>
      <ul>
        <li><strong>Redimensionamento do Raio:</strong> Use os polegares das duas m√£os associadas √† forma. Aproxime ou afaste os polegares (com os outros dedos fechados) para diminuir ou aumentar o tamanho da forma. Dispara um acorde se a mudan√ßa for significativa.</li>
        <li><strong>N√∫mero de Lados:</strong> Com a m√£o esquerda associada √† forma, fa√ßa um gesto de pin√ßa (polegar e indicador). A dist√¢ncia entre os dedos da pin√ßa, quando pr√≥xima √† borda da forma, altera o n√∫mero de lados.</li>
        <li><strong>Distor√ß√£o (Liquify):</strong> Com a m√£o direita associada √† forma, aproxime os dedos da borda da forma para distorcer o contorno.</li>
        <li><strong>Puxar V√©rtices:</strong> Com o modo "Puxar V√©rtices" ativo (tecla V), use o dedo indicador da m√£o direita associada √† forma para "agarrar" e puxar v√©rtices individuais da forma.</li>
      </ul>

      <h4>Teclas de Atalho</h4>
      <ul>
        <li><strong>M:</strong> Ativa ou desativa o envio de mensagens MIDI globalmente.</li>
        <li><strong>P:</strong> Ativa ou desativa o Modo Pulso globalmente.</li>
        <li><strong>L:</strong> Alterna entre modo Staccato e Legato para as notas MIDI.</li>
        <li><strong>V:</strong> Ativa ou desativa o modo "Puxar V√©rtices".</li>
        <li><strong>S:</strong> Cicla entre as escalas musicais dispon√≠veis.</li>
        <li><strong>N:</strong> Cicla entre os modos de gera√ß√£o de nota (Sequencial, Arpejo, etc.).</li>
        <li><strong>Bot√£o "Modo":</strong> Alterna entre opera√ß√£o para 1 pessoa ou 2 pessoas.</li>
      </ul>

      <div class="modal-footer">
        <p>¬© Leonardo Carvalho ‚Äî 2025</p>
        <p><a href="https://www.instagram.com/leocarvalho.exe?igsh=MXg5bHN0Zm12YnhocA==" target="_blank">@leocarvalho.exe</a></p>
      </div>
    </div>
  </div>

  <div id="settingsModal">
    <div class="modal-content">
      <span id="closeSettingsModal">&times;</span>
      <h3>Configura√ß√µes MIDI</h3>
      <label for="midiOutputSelect">Porta de Sa√≠da MIDI:</label>
      <select id="midiOutputSelect">
        <!-- Options will be populated by JavaScript -->
      </select>
      <!-- Add more settings here if needed in the future -->
       <div class="modal-footer">
        <p>As configura√ß√µes s√£o aplicadas em tempo real.</p>
      </div>
    </div>
  </div>

  <video id="video" style="display:none;" playsinline></video>
  <canvas id="canvas"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/osc-js/lib/osc.min.js"></script> 
  <script src="main26.js" defer></script>
  <div id="hud"></div>
</body>
</html>

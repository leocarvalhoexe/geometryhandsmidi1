<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Controlador MIDI Gestual v77</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #111;
      color: white;
      font-family: sans-serif;
    }
    video, canvas {
      position: absolute;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      transform: scaleX(-1);
      z-index: 0;
    }
    #grid {
      display: grid;
      /* grid-template-columns will be set by JS */
      gap: 10px; /* Consider a smaller gap if pads can be small */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }
    .pad {
      /* width and height will be set by JS */
      background: #333;
      border: 2px solid #888;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      font-size: 24px;
      transition: 0.2s;
    }
    .pad.active {
      background: #0f0;
      border-color: #fff;
      color: #111;
      box-shadow: 0 0 20px #0f0;
    }
    .pad.highlight {
      box-shadow: 0 0 10px 5px yellow;
      border-color: yellow;
    }
    .pad.sequencer-column-indicator {
      background-color: #444; /* Indicador da barra principal (horizontal) */
    }
    .pad.sequencer-indicator-secondary {
      background-color: #5e5e00; /* Indicador da barra secundária (cor pode ser mantida ou alterada) */
    }
    #controls-container {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 20;
      background: rgba(50,50,50,0.8);
      padding: 15px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px; /* Reduzido o gap para tentar acomodar mais controles */
      width: 300px; /* Aumentar um pouco a largura para os novos controles */
    }
    #controls-container label{
      display: block; /* Faz os labels ocuparem a linha toda antes do input/select */
      margin-bottom: 2px;
      font-size: 0.9em;
    }
    #controls-container button, #controls-container select, #controls-container input[type="range"], #controls-container input[type="number"] {
      margin-right: 5px;
      width: calc(100% - 10px); /* Faz os inputs/selects ocuparem a largura disponível */
      box-sizing: border-box;
    }
     #controls-container input[type="number"] {
      width: 60px; /* Largura específica para o input de número de semitons */
    }
    .control-group {
        display: flex;
        flex-direction: column; /* Organiza label acima do controle */
        /* align-items: center; */ /* Removido para permitir que o label fique à esquerda do input se for inline-block */
        gap: 2px; /* Gap menor dentro do grupo */
        margin-bottom: 8px; /* Espaço entre grupos de controle */
    }
     .control-group-horizontal { /* Novo grupo para manter BPM e botão na mesma linha */
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 5px;
        margin-bottom: 8px;
    }
    #bpm-display {
        margin-left: 10px;
    }

    #horizontalFaderContainer {
      text-align: center;
      margin-top: 5px; /* Adjusted margin */
    }

    #horizontalBpmFaderSVG {
      /* SVG already has width/height attributes */
    }

    #horizontalBpmFaderSVG .track { /* Assuming you might style a visible track for the BPM fader */
      stroke: #555;
      stroke-width: 8;
      fill: none;
    }

    #horizontalBpmFaderSVG .progress-arc { /* If using arc for BPM, otherwise adapt */
      stroke: #0f0;
      stroke-width: 8;
      fill: none;
      stroke-linecap: round;
    }

    #horizontalBpmFaderSVG .knob { /* Assuming a knob for BPM fader */
      fill: #0f0;
      stroke: #fff;
      stroke-width: 1;
      cursor: pointer;
    }
     #bpmTextDisplay { /* Style for the text within the BPM fader SVG */
        font-family: Arial, sans-serif;
        font-size: 16px;
        fill: white;
        text-anchor: middle;
    }
  </style>
</head>
<body>

<div id="controls-container">
  <div class="control-group">
    <label for="midi-out">MIDI Out:</label>
    <select id="midi-out"></select>
  </div>
  <div class="control-group-horizontal"> <!-- Aplicando classe para layout horizontal -->
    <button id="play-stop-button">Play Barra Prin</button>
    <div id="bpm-display">BPM Prin: 120</div>
  </div>

  <!-- Horizontal BPM Fader -->
  <div id="horizontalFaderContainer">
      <svg id="horizontalBpmFaderSVG" width="250" height="60">
          <defs>
              <linearGradient id="faderTrackGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#a0a0a0;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#e0e0e0;stop-opacity:1" />
              </linearGradient>
          </defs>
          <rect id="faderTrack" x="10" y="20" width="230" height="10" rx="5" ry="5" fill="url(#faderTrackGradient)" stroke="#505050" stroke-width="1"/>
          <rect id="faderThumb" x="10" y="15" width="20" height="20" rx="3" ry="3" fill="#4CAF50" stroke="#388E3C" stroke-width="1" style="cursor: pointer;"/>
          <text id="bpmTextDisplay" x="125" y="50" font-family="Arial, sans-serif" font-size="16" fill="white" text-anchor="middle">BPM: 120</text>
      </svg>
  </div>

  <div class="control-group">
    <label for="rowsInput">Linhas: <span id="rowsValueDisplay">4</span></label>
    <input type="range" id="rowsInput" value="4" min="1" max="16" style="width: 120px;">
  </div>
  <div class="control-group">
    <label for="colsInput">Colunas: <span id="colsValueDisplay">4</span></label>
    <input type="range" id="colsInput" value="4" min="1" max="16" style="width: 120px;">
  </div>
  <div class="control-group">
    <label for="padSizeInput">Tam. Célula: <span id="padSizeValueDisplay">60</span>px</label>
    <input type="range" id="padSizeInput" value="60" min="20" max="100" step="1" style="width: 120px;">
  </div>

  <hr style="border-color: #555; margin: 15px 0;">

  <!-- Controles para a Barra Secundária -->
  <div class="control-group">
    <label for="secondaryNoteOffsetInput">Offset Semitons 2ª Barra:</label>
    <input type="number" id="secondaryNoteOffsetInput" value="12"> <!-- Estilo width já definido no CSS geral -->
  </div>
  <div class="control-group">
    <label for="orientationBar2Select">Orientação 2ª Barra:</label>
    <select id="orientationBar2Select">
      <option value="vertical" selected>Vertical</option>
      <option value="horizontal">Horizontal</option>
    </select>
  </div>
  <div class="control-group">
    <label for="directionBar2Select">Sentido 2ª Barra:</label>
    <select id="directionBar2Select">
      <!-- Opções preenchidas por JS -->
    </select>
  </div>
  <div class="control-group-horizontal"> <!-- Aplicando classe para layout horizontal -->
    <button id="play-stop-button-secondary">Play Barra Sec</button>
    <div id="bpm-display-secondary">BPM Sec: 120</div>
  </div>

  <div id="secondaryFaderContainer">
      <svg id="secondaryBpmFaderSVG" width="250" height="60">
          <rect id="secondaryFaderTrack" x="10" y="20" width="230" height="10" rx="5" ry="5" fill="url(#faderTrackGradient)" stroke="#505050" stroke-width="1"/>
          <rect id="secondaryFaderThumb" x="10" y="15" width="20" height="20" rx="3" ry="3" fill="#FFC107" stroke="#FFA000" stroke-width="1" style="cursor: pointer;"/>
          <text id="secondaryBpmTextDisplay" x="125" y="50" font-family="Arial, sans-serif" font-size="16" fill="white" text-anchor="middle">BPM Sec: 120</text>
      </svg>
  </div>

  <!-- Controles de Sincronização da Barra Secundária -->
  <div class="control-group">
    <label for="secondarySyncSpeedDirection">Dobra Velocidade 2ª Barra:</label>
    <select id="secondarySyncSpeedDirection">
      <option value="up" selected>Para Cima (Mais Rápido)</option>
      <option value="down">Para Baixo (Mais Lento)</option>
    </select>
  </div>
  <div class="control-group">
    <label for="secondarySyncFactor">Fator Sinc. 2ª Barra (x Vezes):</label>
    <input type="number" id="secondarySyncFactor" value="2" min="1" step="1" style="width: 70px;">
  </div>

  <hr style="border-color: #555; margin: 15px 0;">

  <!-- Seção para Barras Extras -->
  <div id="extra-bars-section">
    <h3>Barras Extras</h3>
    <button id="add-extra-bar-button">Adicionar Barra Extra</button>
    <div id="extra-bars-controls-container">
      <!-- Controles para barras extras serão adicionados aqui por JS -->
    </div>
  </div>

</div>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas"></canvas>
<div id="grid"></div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="beatmatrixexe_v77.js"></script>

</body>
</html>
